[{"data":1,"prerenderedAt":406},["ShallowReactive",2],{"navigation":3,"/blog/zig-testing/":54,"/blog/zig-testing/-surround":405},[4],{"title":5,"path":6,"stem":7,"children":8,"page":53},"Blog","/blog","blog",[9,13,17,21,25,29,33,37,41,45,49],{"title":10,"path":11,"stem":12},"Third post","/blog/_lorem-ipsum","blog/_lorem-ipsum",{"title":14,"path":15,"stem":16},"Markdown Style Guide","/blog/_markdown-style-guide","blog/_markdown-style-guide",{"title":18,"path":19,"stem":20},"Remote Debugging Addon for Blender","/blog/blender-debugger","blog/blender-debugger",{"title":22,"path":23,"stem":24},"How to use Dynamic Variables with Tailwind","/blog/dynamic-tailwind","blog/dynamic-tailwind",{"title":26,"path":27,"stem":28},"Krita Popup Palette Improvements","/blog/krita-brush-pr","blog/krita-brush-pr",{"title":30,"path":31,"stem":32},"How to map Mod+Number keys in Vim/Neovim (using Wezterm)","/blog/neovim-wezterm-mod-number-keys","blog/neovim-wezterm-mod-number-keys",{"title":34,"path":35,"stem":36},"Handling Thousands Cards on an Infinite Canvas","/blog/performant-pixi-infinite-canvas","blog/performant-pixi-infinite-canvas",{"title":38,"path":39,"stem":40},"Abusing Typescript's New `satisfies` Operator","/blog/satisfies","blog/satisfies",{"title":42,"path":43,"stem":44},"How to Publish v0.x.x Versioned Packages with Semantic Release","/blog/semantic-release-v0","blog/semantic-release-v0",{"title":46,"path":47,"stem":48},"I cave, Tailwind rocks.","/blog/tailwind-rocks","blog/tailwind-rocks",{"title":50,"path":51,"stem":52},"How To Add Tests To A Zig Project","/blog/zig-testing","blog/zig-testing",false,{"id":55,"title":50,"body":56,"date":395,"description":101,"extension":396,"image":397,"langs":398,"meta":399,"navigation":209,"path":51,"published":209,"rawbody":400,"seo":401,"static_image":397,"stem":52,"tags":402,"video_image":397,"__hash__":404},"blog/blog/zig-testing.md",{"type":57,"value":58,"toc":391},"minimark",[59,71,83,89,92,102,105,110,120,127,160,164,167,276,284,293,381,387],[60,61,62,63,70],"p",{},"I have been dabbling with ",[64,65,69],"a",{"href":66,"rel":67},"https://ziglang.org/",[68],"nofollow","Zig"," lately, and I wanted to add some tests to my tiny project, but this was a bit harder than I thought and the docs on this are sparse. so I thought I'd properly document it.",[60,72,73,74,78,79,82],{},"First, you probably want ",[75,76,77],"code",{},"zig build test"," where test is the build step. Not ",[75,80,81],{},"zig test",".",[60,84,85,86,88],{},"Still, even if you have a test step and you ran ",[75,87,77],{},", you might have been puzzled that no tests were running.",[60,90,91],{},"And if you were using dependencies, you might have gotten an error like this:",[93,94,99],"pre",{"className":95,"code":97,"language":98},[96],"language-text","no module named '...' available within module root\n","text",[75,100,97],{"__ignoreMap":101},"",[60,103,104],{},"Several things are going on here.",[106,107,109],"h2",{"id":108},"adding-all-tests","Adding ALL Tests",[60,111,112,113,115,116,119],{},"If you run ",[75,114,77],{}," it will only run tests in the given ",[75,117,118],{},"root_source_file",", so if you have no tests in main, they won't run.",[60,121,122,123,126],{},"You can get around this with the following magical incantation in ",[75,124,125],{},"src/main.zig",":",[93,128,132],{"className":129,"code":130,"language":131,"meta":101,"style":101},"language-zig shiki shiki-themes material-theme-lighter material-theme material-theme-palenight","test {\n    // include all tests in imported modules, recursively\n    @import(\"std\").testing.refAllDeclsRecursive(@This());\n}\n","zig",[75,133,134,142,148,154],{"__ignoreMap":101},[135,136,139],"span",{"class":137,"line":138},"line",1,[135,140,141],{},"test {\n",[135,143,145],{"class":137,"line":144},2,[135,146,147],{},"    // include all tests in imported modules, recursively\n",[135,149,151],{"class":137,"line":150},3,[135,152,153],{},"    @import(\"std\").testing.refAllDeclsRecursive(@This());\n",[135,155,157],{"class":137,"line":156},4,[135,158,159],{},"}\n",[106,161,163],{"id":162},"sharing-modules-with-the-build-step","Sharing Modules with the Build Step",[60,165,166],{},"The other error is because when you do this:",[93,168,170],{"className":129,"code":169,"language":131,"meta":101,"style":101},"const exe = b.addExecutable(.{\n    .name = \"foot\",\n    .root_source_file = b.path(\"src/main.zig\"),\n    .target = target,\n    .optimize = optimize,\n});\n\nexe.root_module.addImport(...); \n\n// ... \n\nconst tests = b.addTest(.{\n    .root_source_file = b.path(\"src/main.zig\"),\n    .target = target,\n    .optimize = optimize,\n});\n\nconst test_step = b.step(\"test\", \"Run tests.\");\ntest_step.dependOn(&b.addRunArtifact(tests).step);\n",[75,171,172,177,182,187,192,198,204,211,217,222,228,233,239,244,249,254,259,264,270],{"__ignoreMap":101},[135,173,174],{"class":137,"line":138},[135,175,176],{},"const exe = b.addExecutable(.{\n",[135,178,179],{"class":137,"line":144},[135,180,181],{},"    .name = \"foot\",\n",[135,183,184],{"class":137,"line":150},[135,185,186],{},"    .root_source_file = b.path(\"src/main.zig\"),\n",[135,188,189],{"class":137,"line":156},[135,190,191],{},"    .target = target,\n",[135,193,195],{"class":137,"line":194},5,[135,196,197],{},"    .optimize = optimize,\n",[135,199,201],{"class":137,"line":200},6,[135,202,203],{},"});\n",[135,205,207],{"class":137,"line":206},7,[135,208,210],{"emptyLinePlaceholder":209},true,"\n",[135,212,214],{"class":137,"line":213},8,[135,215,216],{},"exe.root_module.addImport(...); \n",[135,218,220],{"class":137,"line":219},9,[135,221,210],{"emptyLinePlaceholder":209},[135,223,225],{"class":137,"line":224},10,[135,226,227],{},"// ... \n",[135,229,231],{"class":137,"line":230},11,[135,232,210],{"emptyLinePlaceholder":209},[135,234,236],{"class":137,"line":235},12,[135,237,238],{},"const tests = b.addTest(.{\n",[135,240,242],{"class":137,"line":241},13,[135,243,186],{},[135,245,247],{"class":137,"line":246},14,[135,248,191],{},[135,250,252],{"class":137,"line":251},15,[135,253,197],{},[135,255,257],{"class":137,"line":256},16,[135,258,203],{},[135,260,262],{"class":137,"line":261},17,[135,263,210],{"emptyLinePlaceholder":209},[135,265,267],{"class":137,"line":266},18,[135,268,269],{},"const test_step = b.step(\"test\", \"Run tests.\");\n",[135,271,273],{"class":137,"line":272},19,[135,274,275],{},"test_step.dependOn(&b.addRunArtifact(tests).step);\n",[60,277,278,281,282,82],{},[75,279,280],{},"tests.root_module"," has no imports added, so it can't find them. You would have to also add them all to ",[75,283,280],{},[60,285,286,287,292],{},"The good news is zig 0.14.0 added the following feature to avoid this duplication, see ",[64,288,291],{"href":289,"rel":290},"https://github.com/ziglang/zig/pull/20388",[68],"#20388",". Now you can create a module and pass it both to the exe and to tests:",[93,294,296],{"className":129,"code":295,"language":131,"meta":101,"style":101},"const main_module = b.createModule(.{\n    .root_source_file = b.path(\"src/main.zig\"),\n    .target = target,\n    .optimize = optimize,\n});\n\nconst exe = b.addExecutable(.{\n    .name = \"foot\",\n    .root_module = main_module,\n});\n\nexe.root_module.addImport(...); \n\n// ... \nconst tests = b.addTest(.{\n    .root_module = main_module,\n});\n\nconst test_step = b.step(\"test\", \"Run tests.\");\ntest_step.dependOn(&b.addRunArtifact(tests).step);\n",[75,297,298,303,307,311,315,319,323,327,331,336,340,344,348,352,356,360,364,368,372,376],{"__ignoreMap":101},[135,299,300],{"class":137,"line":138},[135,301,302],{},"const main_module = b.createModule(.{\n",[135,304,305],{"class":137,"line":144},[135,306,186],{},[135,308,309],{"class":137,"line":150},[135,310,191],{},[135,312,313],{"class":137,"line":156},[135,314,197],{},[135,316,317],{"class":137,"line":194},[135,318,203],{},[135,320,321],{"class":137,"line":200},[135,322,210],{"emptyLinePlaceholder":209},[135,324,325],{"class":137,"line":206},[135,326,176],{},[135,328,329],{"class":137,"line":213},[135,330,181],{},[135,332,333],{"class":137,"line":219},[135,334,335],{},"    .root_module = main_module,\n",[135,337,338],{"class":137,"line":224},[135,339,203],{},[135,341,342],{"class":137,"line":230},[135,343,210],{"emptyLinePlaceholder":209},[135,345,346],{"class":137,"line":235},[135,347,216],{},[135,349,350],{"class":137,"line":241},[135,351,210],{"emptyLinePlaceholder":209},[135,353,354],{"class":137,"line":246},[135,355,227],{},[135,357,358],{"class":137,"line":251},[135,359,238],{},[135,361,362],{"class":137,"line":256},[135,363,335],{},[135,365,366],{"class":137,"line":261},[135,367,203],{},[135,369,370],{"class":137,"line":266},[135,371,210],{"emptyLinePlaceholder":209},[135,373,374],{"class":137,"line":272},[135,375,269],{},[135,377,379],{"class":137,"line":378},20,[135,380,275],{},[60,382,383,384,386],{},"Now ",[75,385,77],{}," should run all tests and give no missing module errors.",[388,389,390],"style",{},"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":101,"searchDepth":144,"depth":144,"links":392},[393,394],{"id":108,"depth":144,"text":109},{"id":162,"depth":144,"text":163},"2025-02-15T00:00:00.000Z","md",null,[131],{},"---\ntitle: \"How To Add Tests To A Zig Project\"\ndate: \"2025-02-15\"\npublished: true\ntags: [\"testing\"]\nlangs: [\"zig\"]\ndescription: \"\"\n---\n\n\nI have been dabbling with [Zig](https://ziglang.org/) lately, and I wanted to add some tests to my tiny project, but this was a bit harder than I thought and the docs on this are sparse. so I thought I'd properly document it.\n\nFirst, you probably want `zig build test` where test is the build step. Not `zig test`.\n\nStill, even if you have a test step and you ran `zig build test`, you might have been puzzled that no tests were running.\n\nAnd if you were using dependencies, you might have gotten an error like this:\n\n```\nno module named '...' available within module root\n```\n\nSeveral things are going on here.\n\n## Adding ALL Tests\n\nIf you run `zig build test` it will only run tests in the given `root_source_file`, so if you have no tests in main, they won't run.\n\nYou can get around this with the following magical incantation in `src/main.zig`:\n\n```zig\ntest {\n    // include all tests in imported modules, recursively\n    @import(\"std\").testing.refAllDeclsRecursive(@This());\n}\n```\n\n## Sharing Modules with the Build Step\n\nThe other error is because when you do this:\n\n```zig\nconst exe = b.addExecutable(.{\n\t.name = \"foot\",\n\t.root_source_file = b.path(\"src/main.zig\"),\n\t.target = target,\n\t.optimize = optimize,\n});\n\nexe.root_module.addImport(...); \n\n// ... \n\nconst tests = b.addTest(.{\n\t.root_source_file = b.path(\"src/main.zig\"),\n\t.target = target,\n\t.optimize = optimize,\n});\n\nconst test_step = b.step(\"test\", \"Run tests.\");\ntest_step.dependOn(&b.addRunArtifact(tests).step);\n```\n\n`tests.root_module` has no imports added, so it can't find them. You would have to also add them all to `tests.root_module`.\n\n\nThe good news is zig 0.14.0 added the following feature to avoid this duplication, see [#20388](https://github.com/ziglang/zig/pull/20388). Now you can create a module and pass it both to the exe and to tests:\n\n```zig\nconst main_module = b.createModule(.{\n\t.root_source_file = b.path(\"src/main.zig\"),\n\t.target = target,\n\t.optimize = optimize,\n});\n\nconst exe = b.addExecutable(.{\n\t.name = \"foot\",\n\t.root_module = main_module,\n});\n\nexe.root_module.addImport(...); \n\n// ... \nconst tests = b.addTest(.{\n\t.root_module = main_module,\n});\n\nconst test_step = b.step(\"test\", \"Run tests.\");\ntest_step.dependOn(&b.addRunArtifact(tests).step);\n```\n\nNow `zig build test` should run all tests and give no missing module errors.\n",{"title":50,"description":101},[403],"testing","h7NrxtGRc_JZC_tpRorguyS7DnRgdjjrFNreeZF89RM",[397,397],1770083874483]