import{u as y,c as f,g,a as v,b as w,s as I,d as b,e as E,f as D,h}from"./KdGnJcjR.js";import"./CTksfxrN.js";import"./Bt5P45U8.js";import{ax as r,ay as p,h as x,az as _}from"./BKh8bA8C.js";import"./iik6CYzq.js";import"./BLETcTSH.js";const R="http",F=c=>{const s=(e="")=>p(c.base,e.replace(/:/g,"/")),n=(e="")=>p(c.base,(e||"/").replace(/:/g,"/"),":"),u=(e,t=null)=>{if(e?.response?.status===404)return t;throw e},o=(e,t)=>{const a={...t,...c.headers,...e?.headers};return e?.ttl&&!a["x-ttl"]&&(a["x-ttl"]=e.ttl+""),a};return{name:R,options:c,hasItem(e,t){return r(s(e),{method:"HEAD",headers:o(t)}).then(()=>!0).catch(a=>u(a,!1))},async getItem(e,t){return await r(s(e),{headers:o(t)}).catch(u)},async getItemRaw(e,t){return(await r.raw(s(e),{responseType:"arrayBuffer",headers:o(t,{accept:"application/octet-stream"})}).catch(u))._data},async getMeta(e,t){const a=await r.raw(s(e),{method:"HEAD",headers:o(t)});let i,d;const m=a.headers.get("last-modified");m&&(i=new Date(m));const l=a.headers.get("x-ttl");return l&&(d=Number.parseInt(l,10)),{status:a.status,mtime:i,ttl:d}},async setItem(e,t,a){await r(s(e),{method:"PUT",body:t,headers:o(a)})},async setItemRaw(e,t,a){await r(s(e),{method:"PUT",body:t,headers:o(a,{"content-type":"application/octet-stream"})})},async removeItem(e,t){await r(s(e),{method:"DELETE",headers:o(t)})},async getKeys(e,t){const a=await r(n(e),{headers:o(t)});return Array.isArray(a)?a:[]},async clear(e,t){await r(n(e),{method:"DELETE",headers:o(t)})}}};function H(c,s){const n=y(c,s);if(!x().public.studio.dev)return n;n.meta.dev=!0;const u=f({driver:F({base:"/__nuxt_studio/dev/content"})});return n.app.requestRerender=()=>{},n.document.db.upsert=_(async(o,e)=>{const t=g(o,h);if(!t)throw new Error(`Collection not found for fsPath: ${o}`);const a=v(o,t),i=w(a,t,e),d=I(i,t),m=await n.document.generate.contentFromDocument(d);await $fetch("/__nuxt_studio/dev/content/"+o,{method:"PUT",body:m,headers:{"content-type":"text/plain"},timeout:100}).catch(()=>{})},100),n.document.db.delete=async o=>{await u.removeItem(o)},n.on.documentUpdate=o=>{(void 0).on("nuxt-content:update",e=>{const t=b(e.key,h),a=E(e.key,t.source),i=D(e.key,a),d=e.queries.length===0;o(i,d?"remove":"update")})},n.on.mediaUpdate=o=>{(void 0).on("nuxt-studio:media:update",e=>{o(e.id,e.type)})},n}export{H as useStudioHost};
